<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lista de Piscinas</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background:#e6f7ff; padding:20px; }
    .card { background: #fff; border-radius:10px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,0.06); max-width:900px; margin:0 auto; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:10px 12px; text-align:left; border-bottom:1px solid #e9eef2; }
    th { font-weight:600; color:#0b5a74; }
    .status { margin-top:8px; color:#666; }
    @media (max-width:600px){ th, td { padding:8px; } }
  </style>
</head>
<body>
  <div class="card">
    <h2>Registros de pH e Cloro</h2>
    <div>
      <button id="refreshBtn">Atualizar</button>
      <span id="status" class="status"></span>
    </div>

    <table aria-label="Tabela de piscinas">
      <thead>
        <tr><th>Nome</th><th>pH</th><th>Cloro (ppm)</th></tr>
      </thead>
      <tbody id="table-body">
        <tr><td colspan="3">Carregando...</td></tr>
      </tbody>
    </table>
  </div>

  <script>
   // 1. DEFINIÇÃO DA URL DA API (adicione a sua URL aqui)
const API_URL = 'https://pool-api-alpha.vercel.app/api/v1/pool/'; // Exemplo de URL

/**
 * 3. FUNÇÃO DE SEGURANÇA (para evitar injeção de HTML)
 * Esta função converte caracteres especiais de HTML em suas entidades,
 * impedindo que um texto malicioso seja interpretado como código.
 */
function escapeHtml(unsafe) {
    if (typeof unsafe !== 'string') return '';
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// 2. CORREÇÃO DE "sync" PARA "async"
async function fetchData() {
    const status = document.getElementById('status');
    const tableBody = document.getElementById('table-body');
    status.textContent = 'Carregando...';

    try {
        const res = await fetch('https://pool-api-alpha.vercel.app/api/v1/pool/');
        if (!res.ok) throw new Error('Resposta HTTP ' + res.status);
        
        const json = await res.json();
        // exemplo de retorno esperado: { "msg":"OK", "data":[ {nome, ph, cloro}, ... ] }
        console.log('API response', json);
        
        if (json.msg && json.msg !== 'OK') throw new Error(json.msg || 'Erro retornado pela API');

        // Supondo que você tenha uma função renderTable para desenhar a tabela
        renderTable(json.data || []); 
        
        status.textContent = (json.data && json.data.length > 0) ? '' : 'Nenhum registro encontrado';

    } catch (err) {
        console.error(err);
        // Usando a função escapeHtml para exibir a mensagem de erro com segurança
        tableBody.innerHTML = `<tr><td colspan="3">Erro ao carregar: ${escapeHtml(err.message)}</td></tr>`;
        status.textContent = 'Erro ao carregar';
    }
}

// Você também precisará da função renderTable, que não estava no seu código original.
// Exemplo de como ela poderia ser:
function renderTable(data) {
    const tableBody = document.getElementById('table-body');
    if (!data || data.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="3">Nenhum registro encontrado</td></tr>';
        return;
    }

    const rows = data.map(item => `
        <tr>
            <td>${escapeHtml(item.nome || '-')}</td>
            <td>${escapeHtml(item.ph || '-')}</td>
            <td>${escapeHtml(item.cloro || '-')}</td>
        </tr>
    `).join('');

    tableBody.innerHTML = rows;
}


// Para iniciar o processo, você chamaria a função:
fetchData();
  </script>
</body>
</html>


