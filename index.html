<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lista de Piscinas</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background:#e6f7ff; padding:20px; }
    .card { background: #fff; border-radius:10px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,0.06); max-width:900px; margin:0 auto; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:10px 12px; text-align:left; border-bottom:1px solid #e9eef2; }
    th { font-weight:600; color:#0b5a74; }
    .status { margin-top:8px; color:#666; }
    @media (max-width:600px){ th, td { padding:8px; } }
  </style>
</head>
<body>
  <div class="card">
    <h2>Registros de pH e Cloro</h2>
    <div>
      <button id="refreshBtn">Atualizar</button>
      <span id="status" class="status"></span>
    </div>

    <table aria-label="Tabela de piscinas">
      <thead>
        <tr><th>Nome</th><th>pH</th><th>Cloro (ppm)</th></tr>
      </thead>
      <tbody id="table-body">
        <tr><td colspan="3">Carregando...</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const API_URL = 'http://localhost:8000/api/pools.php'; // ajuste para sua API

    function escapeHtml(text) {
      if (text == null) return '';
      return String(text)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function renderTable(data) {
      const tbody = document.getElementById('table-body');
      if (!data || data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3">Nenhum registro encontrado.</td></tr>';
        return;
      }
      tbody.innerHTML = data.map(row => `
        <tr>
          <td>${escapeHtml(row.nome ?? '')}</td>
          <td>${row.ph != null ? Number(row.ph).toFixed(2) : '-'}</td>
          <td>${row.cloro != null ? Number(row.cloro).toFixed(2) : '-'}</td>
        </tr>
      `).join('');
    }

    async function fetchData() {
      const status = document.getElementById('status');
      status.textContent = 'Carregando...';
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error('Resposta HTTP ' + res.status);
        const json = await res.json();
        // exemplo de retorno esperado: { "msg":"OK", "data":[ {nome, ph, cloro}, ... ] }
        console.log('API response', json);
        if (json.msg && json.msg !== 'OK') throw new Error(json.msg || 'Erro da API');
        renderTable(json.data || []);
        status.textContent = (json.data && json.data.length) ? '' : 'Nenhum registro';
      } catch (err) {
        console.error(err);
        document.getElementById('table-body').innerHTML = `<tr><td colspan="3">Erro ao carregar: ${escapeHtml(err.message)}</td></tr>`;
        status.textContent = 'Erro';
      }
    }

    document.getElementById('refreshBtn').addEventListener('click', fetchData);
    document.addEventListener('DOMContentLoaded', fetchData);
  </script>
</body>
</html>


